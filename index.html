<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Easy Go | Cart</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .cart-item { transition: all 0.3s; }
        .remove-btn { transition: all 0.2s; }
        .remove-btn:hover { transform: scale(1.1); }
    </style>
</head>
<body class="antialiased bg-gray-50">

    <header class="relative mb-8">
        <div class="h-40 overflow-hidden">
            <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/Banner.png" 
                 class="w-full h-full object-cover" alt="Easy Go Banner">
        </div>
        <div class="absolute -bottom-6 left-0 right-0 flex justify-center">
            <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png" 
                 class="h-20 w-20 rounded-full border-4 border-white shadow-xl bg-white p-1">
        </div>
    </header>

    <div class="max-w-4xl mx-auto px-4 pt-10 pb-20">
        <!-- Navigation -->
        <div class="flex justify-between items-center mb-8">
            <a href="https://clean-scripts.github.io/Easygo-Menu/" 
               class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Continue Shopping
            </a>
            <h1 class="text-3xl font-black uppercase">Your Cart</h1>
        </div>

        <!-- Empty Cart Message -->
        <div id="empty-cart" class="hidden text-center py-16">
            <div class="text-8xl mb-6">üòñüò≠</div>
            <h2 class="text-3xl font-bold text-gray-700 mb-4">
                Your cart is craving for some fantastic evening snacks
            </h2>
            <a href="https://clean-scripts.github.io/Easygo-Menu/" 
               class="inline-block mt-6 px-8 py-4 bg-green-500 text-white font-bold rounded-2xl hover:bg-green-600 transition-colors">
                Browse Menu
            </a>
        </div>

        <!-- Cart Items -->
        <div id="cart-items-container" class="space-y-4 mb-8">
            <!-- Items will be loaded here -->
        </div>

        <!-- Cart Summary -->
        <div id="cart-summary" class="hidden bg-white rounded-3xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold mb-6">Cart Summary</h2>
            
            <div class="space-y-4 mb-6">
                <div class="flex justify-between">
                    <span class="text-gray-600">Items Total</span>
                    <span id="items-total" class="font-bold">‚Çπ0</span>
                </div>
                
                <!-- Coupon Section -->
                <div class="border-t pt-6">
                    <h3 class="font-bold mb-4">Apply Coupon</h3>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="coupon-code" 
                               placeholder="Enter coupon code" 
                               class="flex-1 p-3 border-2 border-gray-300 rounded-xl">
                        <button id="apply-coupon" 
                                class="px-6 bg-green-500 text-white font-bold rounded-xl hover:bg-green-600 transition-colors">
                            Apply
                        </button>
                    </div>
                    <div id="coupon-message" class="text-sm"></div>
                    
                    <div id="coupon-discount" class="hidden mt-4">
                        <div class="flex justify-between text-green-600">
                            <span>Coupon Discount</span>
                            <span id="discount-amount">-‚Çπ0</span>
                        </div>
                    </div>
                </div>
                
                <div class="border-t pt-6">
                    <div class="flex justify-between text-xl font-bold">
                        <span>Total Amount</span>
                        <span id="cart-total">‚Çπ0</span>
                    </div>
                </div>
            </div>
            
            <button id="proceed-to-address" 
                    class="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-xl font-bold rounded-2xl hover:opacity-90 transition-opacity">
                üöö Proceed to Address
            </button>
        </div>

        <!-- Cart Expiry Notice -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-2xl p-6 text-center">
            <p class="text-yellow-700 font-bold">
                ‚è∞ Cart items saved for 1 week
            </p>
            <p class="text-yellow-600 text-sm mt-2">
                Your cart will be automatically cleared after 7 days of inactivity
            </p>
        </div>
    </div>

    <script>
        // Available coupons
        const coupons = {
            'EASYGO10': { discount: 10, type: 'percent' },
            'WELCOME20': { discount: 20, type: 'percent' },
            'FIRST50': { discount: 50, type: 'fixed' }
        };

        let cart = [];
        let appliedCoupon = null;
        let cartExpiry = null;

        // Load cart from localStorage
        function loadCart() {
            const cartData = localStorage.getItem('easygo-cart');
            const expiryData = localStorage.getItem('easygo-cart-expiry');
            
            // Check expiry
            if (expiryData) {
                const expiry = new Date(expiryData);
                if (new Date() > expiry) {
                    localStorage.removeItem('easygo-cart');
                    localStorage.removeItem('easygo-cart-expiry');
                    localStorage.removeItem('easygo-coupon');
                    cart = [];
                } else {
                    cart = JSON.parse(cartData) || [];
                }
            } else {
                cart = JSON.parse(cartData) || [];
            }
            
            // Load coupon
            const couponData = localStorage.getItem('easygo-coupon');
            if (couponData) {
                appliedCoupon = JSON.parse(couponData);
            }
            
            renderCart();
        }

        // Render cart items
        function renderCart() {
            const container = document.getElementById('cart-items-container');
            const emptyCart = document.getElementById('empty-cart');
            const summary = document.getElementById('cart-summary');
            
            if (cart.length === 0) {
                container.innerHTML = '';
                emptyCart.classList.remove('hidden');
                summary.classList.add('hidden');
                return;
            }
            
            emptyCart.classList.add('hidden');
            summary.classList.remove('hidden');
            
            let html = '';
            let itemsTotal = 0;
            
            cart.forEach((item, index) => {
                const itemTotal = parseFloat(item.total);
                itemsTotal += itemTotal;
                
                html += `
                    <div class="cart-item bg-white rounded-2xl shadow p-6 flex items-center gap-6">
                        <img src="${item.image}" alt="${item.name}" 
                             class="w-20 h-20 object-contain rounded-xl">
                        
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">${item.name}</h3>
                            <p class="text-gray-600 text-sm">${getPackName(item.pack)}</p>
                            <p class="text-green-600 font-bold mt-2">‚Çπ${item.total}</p>
                        </div>
                        
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-3">
                                <button onclick="updateQuantity(${index}, -1)" 
                                        class="w-8 h-8 bg-gray-100 rounded-full hover:bg-gray-200">-</button>
                                <span class="font-bold text-lg w-8 text-center">${item.quantity}</span>
                                <button onclick="updateQuantity(${index}, 1)" 
                                        class="w-8 h-8 bg-gray-100 rounded-full hover:bg-gray-200">+</button>
                            </div>
                            
                            <button onclick="removeItem(${index})" 
                                    class="remove-btn ml-4 text-red-500 hover:text-red-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateSummary(itemsTotal);
        }

        // Get pack name
        function getPackName(pack) {
            const names = {
                'piece': 'Per Piece',
                'standard': 'Standard (8 pcs)',
                'family': 'Family Pack (16 pcs)',
                'xl': 'Extra Large (32 pcs)'
            };
            return names[pack] || pack;
        }

        // Update quantity
        function updateQuantity(index, change) {
            cart[index].quantity += change;
            
            if (cart[index].quantity <= 0) {
                cart.splice(index, 1);
            } else {
                cart[index].total = (cart[index].basePrice * 
                    cart[index].multiplier * 
                    cart[index].quantity).toFixed(2);
            }
            
            saveCart();
            renderCart();
        }

        // Remove item
        function removeItem(index) {
            cart.splice(index, 1);
            saveCart();
            renderCart();
        }

        // Update summary
        function updateSummary(itemsTotal) {
            document.getElementById('items-total').textContent = `‚Çπ${itemsTotal.toFixed(2)}`;
            
            let discount = 0;
            if (appliedCoupon) {
                if (appliedCoupon.type === 'percent') {
                    discount = itemsTotal * (appliedCoupon.discount / 100);
                } else {
                    discount = appliedCoupon.discount;
                }
                
                document.getElementById('coupon-discount').classList.remove('hidden');
                document.getElementById('discount-amount').textContent = `-‚Çπ${discount.toFixed(2)}`;
            } else {
                document.getElementById('coupon-discount').classList.add('hidden');
            }
            
            const total = itemsTotal - discount;
            document.getElementById('cart-total').textContent = `‚Çπ${total.toFixed(2)}`;
            
            // Save total for next page
            localStorage.setItem('easygo-cart-total', total.toFixed(2));
        }

        // Save cart to localStorage
        function saveCart() {
            localStorage.setItem('easygo-cart', JSON.stringify(cart));
            
            // Set expiry for 1 week
            const expiry = new Date();
            expiry.setDate(expiry.getDate() + 7);
            localStorage.setItem('easygo-cart-expiry', expiry.toISOString());
        }

        // Apply coupon
        document.getElementById('apply-coupon').addEventListener('click', () => {
            const code = document.getElementById('coupon-code').value.trim().toUpperCase();
            const message = document.getElementById('coupon-message');
            
            if (coupons[code]) {
                appliedCoupon = coupons[code];
                localStorage.setItem('easygo-coupon', JSON.stringify(appliedCoupon));
                
                message.textContent = `Coupon "${code}" applied successfully!`;
                message.className = 'text-sm text-green-600';
                
                renderCart();
            } else {
                message.textContent = 'Invalid coupon code';
                message.className = 'text-sm text-red-600';
            }
        });

        // Proceed to address
        document.getElementById('proceed-to-address').addEventListener('click', () => {
            if (cart.length > 0) {
                window.location.href = 'https://clean-scripts.github.io/Easygo-Address/';
            }
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', loadCart);
    </script>
</body>
</html>
