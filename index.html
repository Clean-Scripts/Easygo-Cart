<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <title>Easy Go | Cart</title>
</head>
<body>
    <!-- Your existing HTML structure -->
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCU_wJYBTwEwMZQ-iTYOjUZuEHEphA0DXc",
            authDomain: "easygo-10f4b.firebaseapp.com",
            projectId: "easygo-10f4b",
            storageBucket: "easygo-10f4b.firebasestorage.app",
            messagingSenderId: "197660067542",
            appId: "1:197660067542:web:6c616efb479b122f1f6b77",
            databaseURL: "https://easygo-10f4b-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        
        let database;
        let isFirebaseConnected = false;
        
        function initializeFirebase() {
            try {
                const app = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", function(snap) {
                    isFirebaseConnected = snap.val() === true;
                });
            } catch (error) {
                console.error("Firebase error:", error);
            }
        }
        
        // Track cart actions
        function trackCartAction(action, cartData) {
            if (!isFirebaseConnected) return;
            
            database.ref('cart_actions').push().set({
                action: action,
                ...cartData,
                timestamp: Date.now(),
                date: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebase();
            
            // Track cart view
            const cart = JSON.parse(localStorage.getItem('easygo-cart') || '[]');
            if (isFirebaseConnected && cart.length > 0) {
                database.ref('cart_views').push().set({
                    items_count: cart.length,
                    total: cart.reduce((sum, item) => sum + (item.totalPrice || 0), 0),
                    timestamp: Date.now(),
                    date: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
                });
            }
            
            // Track proceed to address
            document.getElementById('proceed-to-address').addEventListener('click', function() {
                trackCartAction('proceed_to_address', {
                    items_count: cart.length,
                    total: cart.reduce((sum, item) => sum + (item.totalPrice || 0), 0)
                });
            });
        });
    </script>
</body>
</html>
